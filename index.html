<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChargebeeBot - Voice Assistant</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Theme Switcher -->
    <div class="theme-switcher">
        <button class="theme-btn active" data-theme="light" title="Light Theme">â˜€ï¸</button>
        <button class="theme-btn" data-theme="dark" title="Dark Theme">ğŸŒ™</button>
    </div>

    <!-- Connection Status Banner -->
    <div class="connection-banner" id="connectionBanner">
        <span id="connectionMessage">Checking connection...</span>
    </div>

    <!-- Keyboard Shortcuts Help -->
    <div class="shortcuts-help" id="shortcutsHelp">
        <div class="shortcuts-title">
            âŒ¨ï¸ Keyboard Shortcuts
        </div>
        <div class="shortcut-item">
            <span>Send message</span>
            <kbd class="shortcut-key">Enter</kbd>
        </div>
        <div class="shortcut-item">
            <span>Voice input</span>
            <kbd class="shortcut-key">Ctrl+M</kbd>
        </div>
        <div class="shortcut-item">
            <span>Clear chat</span>
            <kbd class="shortcut-key">Ctrl+L</kbd>
        </div>
        <div class="shortcut-item">
            <span>Show history</span>
            <kbd class="shortcut-key">Ctrl+H</kbd>
        </div>
        <div class="shortcut-item">
            <span>Toggle theme</span>
            <kbd class="shortcut-key">Ctrl+T</kbd>
        </div>
        <div class="shortcut-item">
            <span>Show shortcuts</span>
            <kbd class="shortcut-key">Ctrl+?</kbd>
        </div>
    </div>

    <div class="container">
        <header class="header">
            <div class="logo">ğŸ¤– ChargebeeBot</div>
            <div class="tagline">Your AI-powered subscription billing expert</div>
            <div class="conversation-context" id="contextDisplay">
                Ready to help with subscription billing, integrations, and business growth
            </div>
        </header>

        <main class="main-content">
            <div class="chat-container">
                <!-- Loading Overlay -->
                <div class="loading-overlay" id="loadingOverlay">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <div class="loading-text" id="loadingText">Connecting to ChargebeeBot...</div>
                        <div class="loading-progress">
                            <div class="loading-progress-bar"></div>
                        </div>
                    </div>
                </div>

                <div class="chat-header">
                    <span>ğŸ’¬ Conversation with ChargebeeBot</span>
                    <div class="audio-visualizer" id="audioVisualizer" style="display: none;">
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                        <div class="audio-bar"></div>
                    </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message bot">
                        <strong>Hello! I'm ChargebeeBot, your subscription billing expert.</strong><br><br>
                        I specialize in helping with:
                        <ul style="margin: 10px 0 0 20px;">
                            <li>Chargebee pricing and plans</li>
                            <li>API integrations and technical implementation</li>
                            <li>Subscription billing strategies</li>
                            <li>Revenue analytics and compliance</li>
                            <li>Customer lifecycle management</li>
                        </ul>
                        <br>
                        <em>How can I assist you with Chargebee today? You can type your question or use the voice button to speak.</em>
                    </div>
                </div>

                <div class="input-container">
                    <div class="input-group">
                        <input 
                            type="text" 
                            class="message-input" 
                            id="messageInput" 
                            placeholder="Ask me about Chargebee pricing, APIs, billing strategies..."
                            maxlength="500"
                        >
                        <button class="voice-button" id="voiceButton" title="Click to speak">
                            ğŸ¤
                        </button>
                        <button class="send-button" id="sendButton">Send</button>
                    </div>
                </div>
            </div>

            <aside class="sidebar">
                <div class="status-panel">
                    <h3>ğŸ”§ System Status</h3>
                    <div class="status-item">
                        <span>Google Gemini AI</span>
                        <div class="status-indicator" id="aiStatus"></div>
                    </div>
                    <div class="status-item">
                        <span>Speech Recognition</span>
                        <div class="status-indicator" id="speechStatus"></div>
                    </div>
                    <div class="status-item">
                        <span>Text-to-Speech</span>
                        <div class="status-indicator" id="ttsStatus"></div>
                    </div>
                    <div class="status-item">
                        <span>Knowledge Base</span>
                        <div class="status-indicator"></div>
                    </div>
                </div>
                <div class="user-type-selector">
                    <h3>ğŸ‘¤ I am a...</h3>
                    <div class="user-type-grid">
                        <button class="user-type-btn" data-type="executive">ğŸ”µ Executive</button>
                        <button class="user-type-btn" data-type="developer">ğŸŸ¢ Developer</button>
                        <button class="user-type-btn" data-type="finance">ğŸŸ¡ Finance</button>
                        <button class="user-type-btn" data-type="product">ğŸŸ  Product</button>
                        <button class="user-type-btn" data-type="support">ğŸ”´ Support</button>
                        <button class="user-type-btn active" data-type="general">ğŸŸ£ General</button>
                    </div>
                </div>
            </aside>
        </main>

        <div class="quick-actions">
            <h3>âš¡ Quick Actions</h3>
            <div class="actions-grid">
                <!-- Main Actions Column -->
                <div class="action-column">
                    <div class="action-column-title">ğŸ’¼ Main Actions</div>
                    <button class="action-btn" onclick="sendQuickMessage('Show me Chargebee pricing plans')">ğŸ’° View Pricing</button>
                    <button class="action-btn" onclick="sendQuickMessage('How do I integrate with Stripe?')">ğŸ”Œ API Integration</button>
                    <button class="action-btn" onclick="sendQuickMessage('Schedule a demo')">ğŸ“… Book Demo</button>
                    <button class="action-btn" onclick="sendQuickMessage('What is the ROI of Chargebee?')">ğŸ“Š Show ROI</button>
                    <button class="action-btn" onclick="sendQuickMessage('Help with billing automation')">âš™ï¸ Automation</button>
                    <button class="action-btn" onclick="sendQuickMessage('Revenue recognition setup')">ğŸ“ˆ Revenue Ops</button>
                </div>
                
                <!-- Data Management Column -->
                <div class="action-column">
                    <div class="action-column-title">ğŸ“ Data Management</div>
                    <button class="action-btn" onclick="showConversationHistory()" style="background: var(--purple-600); color: white;">ğŸ“‹ View History</button>
                    <button class="action-btn" onclick="clearConversation()" style="background: var(--red-500); color: white;">ğŸ—‘ï¸ Clear Chat</button>
                    <button class="action-btn" onclick="exportConversation('txt')" style="background: var(--blue-600); color: white;">ğŸ“„ Export TXT</button>
                    <button class="action-btn" onclick="exportConversation('json')" style="background: var(--green-600); color: white;">ğŸ“Š Export JSON</button>
                </div>
                
                <!-- Debug & Testing Column -->
                <div class="action-column">
                    <div class="action-column-title">ğŸ”§ Debug & Testing</div>
                    <button class="action-btn" onclick="toggleDebugMode()" style="background: var(--blue-800); color: white;">ğŸ” Debug Mode</button>
                    <button class="action-btn" onclick="testCompleteMessage()" style="background: var(--lime-500); color: var(--blue-900);">ğŸ§ª Test Complete</button>
                    <button class="action-btn" onclick="testMarkedFormatting()" style="background: var(--purple-600); color: white;">âœ¨ Test Marked.js</button>
                    <button class="action-btn" onclick="testFallbackResponse()" style="background: var(--orange-400); color: white;">ğŸ”„ Test Fallback</button>
                    <button class="action-btn" onclick="testSpecificFallback('pricing')" style="background: var(--blue-600); color: white; font-size: 0.8rem;">ğŸ’° Test Pricing Fallback</button>
                    <button class="action-btn" onclick="testAllInteractiveElements()" style="background: var(--red-600); color: white; font-size: 0.8rem;">ğŸ”§ Test All Elements</button>
                </div>
            </div>
        </div>

        <div class="debug-panel" id="debugPanel" style="display: none;">
            <h3>ğŸ” Debug Panel</h3>
            <div class="debug-controls">
                <button class="debug-btn" onclick="toggleDebugMode()" id="debugToggle">Enable Debug</button>
                <button class="debug-btn" onclick="clearDebugLog()">Clear Log</button>
            </div>
            <div class="debug-content">
                <div class="debug-section">
                    <h4>ğŸ¤– Last Gemini AI Response</h4>
                    <div class="debug-response" id="debugResponse">
                        <em>No response yet. Send a message to see the raw AI response.</em>
                    </div>
                </div>
                <div class="debug-section">
                    <h4>ğŸ“Š Response Analysis</h4>
                    <div class="debug-stats" id="debugStats">
                        <div class="stat-item">Character count: <span id="charCount">0</span></div>
                        <div class="stat-item">Word count: <span id="wordCount">0</span></div>
                        <div class="stat-item">Line breaks: <span id="lineBreaks">0</span></div>
                        <div class="stat-item">Contains markdown: <span id="hasMarkdown">No</span></div>
                        <div class="stat-item">Contains links: <span id="hasLinks">No</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="floating-assistant" id="floatingAssistant" title="Quick Voice Assistant">
        ğŸ™ï¸
    </div>

    <!-- Conversation History Modal -->
    <div class="modal-overlay" id="historyModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“‹ Conversation History</h2>
                <button class="modal-close" onclick="closeConversationHistory()">âœ•</button>
            </div>
            <div class="modal-content">
                <div class="conversation-history" id="conversationHistory">
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        No conversation history yet. Start chatting with ChargebeeBot to see your history here.
                    </p>
                </div>
                <div class="export-section">
                    <button class="export-btn txt" onclick="exportConversation('txt')">
                        ğŸ“„ Export as TXT
                    </button>
                    <button class="export-btn json" onclick="exportConversation('json')">
                        ğŸ“Š Export as JSON
                    </button>
                    <button class="export-btn pdf" onclick="exportConversation('pdf')">
                        ğŸ“• Export as PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Third-party markdown renderer -->
    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
